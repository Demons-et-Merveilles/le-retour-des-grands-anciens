<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="./style.css" rel="stylesheet"/>
    <title> D√©mons et Merveilles</title>
</head>

<body class="bgmed">

<div class="menu">
    <div class="menugauche">
        <div class="menu-button" onclick="loadRealPage('countdown');"> Grands anciens</div>
        <div class="menu-button" onclick="loadRealPage('jdrs');"> Actualit√©s</div>
    </div>

    <img id="logo" src="./images/demPNG.png" alt="Logo D√©mons et Merveilles">

    <div class="menudroite">
        <div class="menu-button" onclick="loadRealPage('histoire');"> Notre Histoire</div>
        <div class="menu-button" onclick="loadRealPage('contact');"> Contact</div>
    </div>
</div>

<div id="page-content">
</div>
</body>
<footer>
    <script>

        async function loadRealPage(pageName) {
            const contentContainer = document.getElementById('page-content');

            try {
                // Afficher le loader
                contentContainer.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        Chargement de la page...
                    </div>
                `;

                // Charger la page depuis le serveur
                const response = await fetch(`./pages/${pageName}.html`);

                if (!response.ok) {
                    throw new Error(`Erreur ${response.status}: ${response.statusText}`);
                }

                const content = await response.text();
                contentContainer.innerHTML = `${content}`;
                if (pageName === "jdrs") {
                    generateCards(cardsData);
                }
            } catch (error) {
                contentContainer.innerHTML = `
                    <div class="error">
                        ‚ùå Erreur lors du chargement de la page "${pageName}" : ${error.message}
                    </div>
                `;
            }
        }

        window.onload = function () {
            loadRealPage("countdown"); //starting page
            updateCountdown();
        }


        // Date future vers laquelle on compte (exemple : 25 d√©cembre 2025, 18h00)
        const targetDate = new Date('2025-11-15T14:00:00');


        function formatTime(seconds) {
            const jours = Math.floor(seconds / (24 * 3600));
            seconds %= (24 * 3600);

            const heures = Math.floor(seconds / 3600);
            seconds %= 3600;

            const minutes = Math.floor(seconds / 60);
            seconds %= 60;

            return `${jours} JOUR${jours > 1 ? 'S' : ''} \n` +
                `${heures < 10 ? '0' + heures : heures} HEURE${heures > 1 ? 'S' : ''} \n` +
                `${minutes < 10 ? '0' + minutes : minutes} MINUTE${minutes > 1 ? 'S' : ''} \n` +

                `${seconds < 10 ? '0' + seconds : seconds} SECONDE${seconds > 1 ? 'S' : ''} `;
        }

        function updateCountdown() {
            countdownElement = document.getElementById('countdown');
            if (countdownElement == null)
                return;

            const now = new Date();
            let timeLeft = Math.floor((targetDate - now) / 1000);

            if (timeLeft > 0) {
                countdownElement.textContent = formatTime(timeLeft);
            } else {
                countdownElement.textContent = "C'est maintenant !";
                clearInterval(timer);
            }
        }


        const timer = setInterval(updateCountdown, 1000);

        /*************************************/
        /*      Chargement des JDRS 	     */
        /*************************************/

        let cardsData = [];
        fetch("data/jdr.json")
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erreur lors du chargement du JSON (${response.status})`);
                }
                return response.json();
            })
            .then(data => {
                cardsData = data;
                console.log("‚úÖ Cartes charg√©es :", cardsData);
            })
            .catch(error => {
                console.error("‚ùå Impossible de charger les cartes :", error);
            });


        // Template HTML de base
        const cardTemplate = `
<div class="card%cardsize% %cardtype%">
    <div class="card-image-container">
        <img class="card-image" src="%urlimage%" alt="Logo du JDR">
    </div>

    <hr class="card-hr"/>
    <div class="card-content">
        <span class="card-title">%title%</span>
        <span class="card-description">%description%  </span>
        <span class="card-mastering"> 
        <h3> %mastering% <a href="%link%" style="color:lightblue"> %link% </a> </h3>
      </span>
    </div>
</div>
`;

        function generateCards(cards) {
            const container = document.querySelector(".card-container");
            if (!container) {
                console.error("‚ùå √âl√©ment .card-container introuvable dans le DOM !");
                return;
            }

            console.log("üÉè G√©n√©ration des cartes...");
            container.innerHTML = cards
                .map(card => {
                    return cardTemplate
                        .replace("%cardsize%", card.format === "double" ? "Double" : "")
                        .replace("%cardtype%", card.type??"")
                        .replace("%urlimage%", card.image??"")
                        .replace("%title%", card.title??"")
                        .replace("%description%", card.description??"")
                        .replace("%mastering%", card.type === "jdr" ? "Masteris√© par "+card.mastering: card.mastering)
                        .replaceAll("%link%",card.link??"");
                })
                .join("");
        }
    </script>
</footer>
</html>